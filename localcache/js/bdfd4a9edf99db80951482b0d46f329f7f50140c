M.course=M.course||{};M.course.format=M.course.format||{};M.course.format.fmtBannerPreviewSlice=function(){var bannersliceDom=document.querySelector("body.format-multitopic div#page select#id_bannerslice");var bannerslice=bannersliceDom.options[bannersliceDom.selectedIndex].value;var headerDom=document.querySelector("body.format-multitopic div#course-header, body.format-multitopic div#page-mast");var bannerDom=headerDom.querySelector("div#course-header-banner");var bannerStyleOld=bannerDom.getAttribute("style");var bannerStyle=bannerStyleOld.replace(/\b(background-position: [a-z0-9%]+ )([0-9]+%)(;?)/,"$1"+bannerslice+"%"+"$3");bannerDom.setAttribute("style",bannerStyle)};M.course.format.fmtBannerPreviewImage=function(){var imageFilemanagerDom=document.querySelector("body.format-multitopic div#page #id_descriptionhdr .filemanager");var imageFileDom=imageFilemanagerDom.classList.contains("fm-nofiles")?null:imageFilemanagerDom.querySelector(".fp-content .fp-file.fp-hascontextmenu, "+".fp-content .fp-filename-icon.fp-hascontextmenu");var imageThumbDom=imageFileDom?imageFileDom.querySelector(".fp-thumbnail img.realpreview, .fp-icon img.realpreview"):null;var imageUrl=imageThumbDom?imageThumbDom.getAttribute("src").split("?")[0]:"";var imageFilename=imageFileDom?imageFileDom.querySelector(".fp-filename").textContent:"";var imageName=(imageFilename.lastIndexOf(".")>-1)?imageFilename.substr(0,imageFilename.lastIndexOf(".")):imageFilename;var headerDom=document.querySelector("body.format-multitopic div#course-header, body.format-multitopic div#page-mast");var bannerDom=headerDom.querySelector("div#course-header-banner");var bannerAttributionDom=headerDom.querySelector("p#course-header-banner_attribution");var bannerStyleOld=bannerDom.getAttribute("style");var bannerStyle=bannerStyleOld.replace(/\b(background-image: )(url\('[^']*'\))(;?)/,"$1"+"url('"+imageUrl+"')"+"$3");bannerStyle=bannerStyle.replace(/\b(background-image: )(url\("[^"]*"\))(;?)/,"$1"+"url('"+imageUrl+"')"+"$3");bannerDom.setAttribute("style",bannerStyle);bannerAttributionDom.textContent=bannerAttributionDom.textContent.replace(/([^:]*: )(.*)/,"$1"+imageName+" ...");bannerAttributionDom.setAttribute("style","visibility: "+(imageFileDom?"visible ":"hidden")+";")};M.course.format.fmtBannerPreviewInit=function(){if(document.readyState!="complete"){return}
var bannersliceDom=document.querySelector("body.format-multitopic div#page select#id_bannerslice");if(bannersliceDom){bannersliceDom.addEventListener("change",M.course.format.fmtBannerPreviewSlice)}
var imageFilemanagerDom=document.querySelector("body.format-multitopic div#page #id_descriptionhdr .filemanager");if(imageFilemanagerDom){var config={attributes:!0,childList:!0,subtree:!0};var observer=new MutationObserver(M.course.format.fmtBannerPreviewImage);observer.observe(imageFilemanagerDom,config)}};document.addEventListener("readystatechange",M.course.format.fmtBannerPreviewInit);M.course.format.fmtBannerPreviewInit(null)